services:
  # Service WebSocket Server
  - type: web
    name: ram-websocket-server
    env: node
    plan: free
    buildCommand: cd server && npm install
    startCommand: cd server && node index.js
    envVars:
      - key: PORT
        value: 8090
      - key: NODE_ENV
        value: production
      - key: ALLOW_POP3_CONNECTION_REFUSED
        value: "true"
      - key: POP3_CONNECTION_TIMEOUT
        value: "5000"
      - key: POP3_SOCKET_TIMEOUT
        value: "5000"
    healthCheckPath: /health

  # Service Client React
  - type: web
    name: ram-react-client
    env: node
    plan: free
    buildCommand: cd client && npm install && npm run build
    startCommand: cd client && npm start
    envVars:
      - key: PORT
        value: 3002
      - key: NODE_ENV
        value: production
    # IMPORTANT: Variables VITE_* à configurer dans le Dashboard Render
    # Les variables VITE_* sont intégrées au BUILD par Vite
    # 
    # Étapes pour que les changements prennent effet:
    # 1. Allez dans Render Dashboard > ram-react-client > Settings > Environment
    # 2. Ajoutez/modifiez les variables:
    #    - VITE_WS_HOST (ex: ram-ws-backend.onrender.com)
    #    - VITE_TELEGRAM_TOKEN (votre token bot Telegram)
    #    - VITE_TELEGRAM_CHAT_ID (votre chat ID Telegram)
    # 3. REDÉPLOYEZ le service (Manual Deploy > Clear build cache & deploy)
    #    OU faites un commit/push pour déclencher un nouveau déploiement
    #
    # Note: Si vous changez juste la variable dans le Dashboard sans redéployer,
    # le build existant utilisera encore l'ancienne valeur car Vite intègre
    # les variables au moment du BUILD, pas au runtime.

